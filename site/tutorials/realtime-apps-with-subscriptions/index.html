
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content=""Follow along as we build slackr, a realtime messaging app complete with social authentication."">
      
      
      
        <meta name="author" content=""Michael Paris"">
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.2, mkdocs-material-1.3.0">
    
    
      
        <title>How to Build Realtime Apps with GraphQL Subscriptions</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-1d1da4857d.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/base.css">
    
      <link rel="stylesheet" href="../../css/styles.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="Scaphold Docs" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Tutorials
                </span>
              
            
            Build A Chat App
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/scaphold-io/scaphold-docs" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Scaphold Docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/scaphold-io/scaphold-docs" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/jumpstart-video/" title="Jumpstart Video" class="md-nav__link">
      Jumpstart Video
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/starter-kits/" title="Starter Kits" class="md-nav__link">
      Starter Kits
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/schema/" title="The Schema" class="md-nav__link">
      The Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/queries/" title="Queries" class="md-nav__link">
      Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/mutations/" title="Mutations" class="md-nav__link">
      Mutations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/subscriptions/" title="Subscriptions" class="md-nav__link">
      Subscriptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/connections-pagination/" title="Connections" class="md-nav__link">
      Connections
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Authentication
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Authentication
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication/tokens/" title="Auth Tokens" class="md-nav__link">
      Auth Tokens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication/permissions/" title="Permissions" class="md-nav__link">
      Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication/social/" title="Social Auth" class="md-nav__link">
      Social Auth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication/super-users/" title="Super Users" class="md-nav__link">
      Super Users
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Realtime Subscriptions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Realtime Subscriptions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime/subscriptions-apollo/" title="Subscriptions With Apollo Client" class="md-nav__link">
      Subscriptions With Apollo Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime/subscriptions-react/" title="Subscriptions With React" class="md-nav__link">
      Subscriptions With React
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime/slackr-chat-app/" title="Build Slack Tutorial" class="md-nav__link">
      Build Slack Tutorial
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Custom Logic
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Custom Logic
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/composition/" title="Function Composition" class="md-nav__link">
      Function Composition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/pre-operations/" title="Pre Operations" class="md-nav__link">
      Pre Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/operation-phase/" title="Operation Phase" class="md-nav__link">
      Operation Phase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/post-operations/" title="Post Operations" class="md-nav__link">
      Post Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/async-operations/" title="Async Operations" class="md-nav__link">
      Async Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/logs/" title="Logs & Examples" class="md-nav__link">
      Logs & Examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Persisted Queries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Persisted Queries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../persisted-queries/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../persisted-queries/getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../persisted-queries/querying-from-client/" title="Querying From Client" class="md-nav__link">
      Querying From Client
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Files
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Files
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../files/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../files/uploading/" title="Uploading" class="md-nav__link">
      Uploading
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../files/querying/" title="Querying" class="md-nav__link">
      Querying
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Integrations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/email/" title="Email" class="md-nav__link">
      Email
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/passwordless/" title="Passwordless Auth" class="md-nav__link">
      Passwordless Auth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/push/" title="Push Notifications" class="md-nav__link">
      Push Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-6" type="checkbox" id="nav-9-6">
    
    <label class="md-nav__link" for="nav-9-6">
      Search
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-6">
        Search
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/search/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/search/querying/" title="Querying" class="md-nav__link">
      Querying
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-7" type="checkbox" id="nav-9-7">
    
    <label class="md-nav__link" for="nav-9-7">
      Social Auth
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-7">
        Social Auth
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/social/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/social/login-with-native/" title="Login With Native SDKs" class="md-nav__link">
      Login With Native SDKs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/social/login-with-auth0/" title="Login With Auth0" class="md-nav__link">
      Login With Auth0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      App Management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        App Management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/alias/" title="Aliases" class="md-nav__link">
      Aliases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/analytics/" title="Analytics" class="md-nav__link">
      Analytics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/export-schema/" title="Export Schema" class="md-nav__link">
      Export Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/fork-app/" title="Fork App" class="md-nav__link">
      Fork App
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/teams/" title="Teams" class="md-nav__link">
      Teams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/multi-region/" title="Multi Region" class="md-nav__link">
      Multi Region
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/admin-tokens/" title="Admin Tokens" class="md-nav__link">
      Admin Tokens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/token-expiration/" title="Token Expiration" class="md-nav__link">
      Token Expiration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" checked>
    
    <label class="md-nav__link" for="nav-11">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
    <a href="./" title="Build A Chat App" class="md-nav__link md-nav__link--active">
      Build A Chat App
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sending-push-notifications/" title="Sending Push Notifications" class="md-nav__link">
      Sending Push Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ios-push-notifications/" title="Setup iOS Push" class="md-nav__link">
      Setup iOS Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../android-push-notifications/" title="Setup Android Push" class="md-nav__link">
      Setup Android Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../migrate-mongodb-graphql/" title="Migrating MongoDB" class="md-nav__link">
      Migrating MongoDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../persisted-queries/" title="Using Persisted Queries" class="md-nav__link">
      Using Persisted Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-queries/" title="Advanced Relational Queries" class="md-nav__link">
      Advanced Relational Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../authentication-in-graphql/" title="Authentication in GraphQL" class="md-nav__link">
      Authentication in GraphQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../search-with-algolia/" title="Add Search With Algolia" class="md-nav__link">
      Add Search With Algolia
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aggregations-in-graphql/" title="Aggregations In GraphQL" class="md-nav__link">
      Aggregations In GraphQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../apollo-optics-graphql-server/" title="Integrate Apollo Optics" class="md-nav__link">
      Integrate Apollo Optics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../adding-social-auth/" title="Add Social Auth" class="md-nav__link">
      Add Social Auth
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../errors/" title="Errors" class="md-nav__link">
      Errors
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-case-for-subscriptions" title="The Case for Subscriptions" class="md-nav__link">
    The Case for Subscriptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#this-tutorial-tldr" title="This Tutorial (TLDR)" class="md-nav__link">
    This Tutorial (TLDR)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-the-code-on-github" title="Get the code on Github" class="md-nav__link">
    Get the code on Github
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" title="Getting Started" class="md-nav__link">
    Getting Started
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#were-happy-to-announce-that-subscriptions-are-now-available-for-all-scaphold-apps" title="We're happy to announce that subscriptions are now available for all Scaphold Apps!" class="md-nav__link">
    We're happy to announce that subscriptions are now available for all Scaphold Apps!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#design-our-data-model" title="Design our Data Model" class="md-nav__link">
    Design our Data Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploring-your-api-in-graphiql" title="Exploring your API in GraphiQL" class="md-nav__link">
    Exploring your API in GraphiQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-to-your-api-from-your-application" title="Connecting to your API from your application" class="md-nav__link">
    Connecting to your API from your application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-subscriptions-from-vanilla-js" title="Using subscriptions from vanilla js" class="md-nav__link">
    Using subscriptions from vanilla js
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#merging-changes-with-the-client-side-cache" title="Merging changes with the client side cache" class="md-nav__link">
    Merging changes with the client side cache
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-subscriptions-from-react" title="Using Subscriptions from React" class="md-nav__link">
    Using Subscriptions from React
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-authentication" title="User Authentication" class="md-nav__link">
    User Authentication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#social-authentication-for-any-application" title="Social authentication for any application" class="md-nav__link">
    Social authentication for any application
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrapping-up" title="Wrapping Up" class="md-nav__link">
    Wrapping Up
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/scaphold-io/scaphold-docs/edit/master/docs/tutorials/realtime-apps-with-subscriptions.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                
                
                  <h1>Build A Chat App</h1>
                
                <h2 id="the-case-for-subscriptions">The Case for Subscriptions</h2>
<p>When Facebook open-sourced GraphQL, they described how applications can perform reads with queries, and writes with mutations. However, often times clients want to get pushed updates from the server when data they care about changes. Enter GraphQL Subscriptions. Subscriptions make real-time functionality a first class citizen in GraphQL!</p>
<p>Subscriptions offer a clean and efficient way to get pushed updates in realtime. They act in parallel to mutations. Just like how mutations describe the set of actions you can take to change your data, subscriptions define the set of events that you can subscribe to when data changes. In fact, you can think of subscriptions as a way to react to mutations that are performed on your server.</p>
<p>For example, think about a chat application like <strong>Slack</strong>. To create a good user experience, our application needs to stay up to date at all times. I.E. when a co-worker sends me a message, I shouldn't have to refresh the page to see the message. A much better solution is to have the server push my chat client the message as soon as it is created. This is how Subscriptions work. When someone creates a message (or in other words issues a mutation), the server immediately pushes the data to every client that is also subscribed to that event.</p>
<p>To build an app like Slack, we need to be able to say:</p>
<blockquote>
<p>Hey, every time someone posts a new message to a channel I am a member of, tell me!</p>
</blockquote>
<p>With subscriptions we can do this by issuing a query like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>subscription SubscribeToNewMessage($messageFilter: MessageWhereArgs) {
    subscribeToMessage(mutations:[createMessage], filter: $messageFilter) {
        mutation
        value {
            id
            content
        }
    }
}
</pre></div>
</td></tr></table>

<p>For now, don't worry too much about the input arguments but just note that we can choose which mutations we would like to subscribe to as well as supply certain filters so that we only get pushed updates for the data we care about.</p>
<p>Now, every time another user calls a mutation like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>mutation CreateMessage($message: CreateMessageInput!) {
    createMessage(input: $message) {
        changedMessage {
            id
            content
        }
    }
}
</pre></div>
</td></tr></table>

<p>Every subscribed client will be pushed an update as long as the new message satisfies the filter it used to first subscribe! It's that easy!</p>
<h2 id="this-tutorial-tldr">This Tutorial (TLDR)</h2>
<p>Throughout this post, we are going to take a <strong>practical dive into GraphQL subscriptions and build a simple chat application</strong>. To do this we will be building a React application in the spirit of Slack that we are going to call <strong>Slackr</strong>. Our application will come complete with realtime messaging and social authentication. Although, we will be using React for demonstration purposes, Apollo Client and subscriptions will work with basically any Javascript frontend so I will do my best to keep the code snippets in this post as unopinionated as possible.</p>
<p>We are going to use <a href="https://scaphold.io"><strong>Scaphold.io</strong></a> as our backend provider because we can get a powerful, realtime GraphQL API in a matter of minutes (less than 4 minutes to be exact) when it could take weeks to build and deploy our own. If you are interested in how subscriptions are implemented on the backend I will be following up this post with a server-side technical review of how we implemented subscriptions on our servers.</p>
<p>Check out slackr!</p>
<p><img alt="" src="https://assets.scaphold.io/tutorials/slackr/slackr.gif" /></p>
<h5 id="get-the-code-on-github">Get the code on Github</h5>
<p>If you would like to follow along, our <a href="https://github.com/scaphold-io/slackr-graphql-subscriptions-starter-kit"><strong>Slackr</strong> Starter Kit is available on Github</a>. We will only be looking at snippets from that repo so take a peek if you'd like to see the whole picture.</p>
<h2 id="getting-started">Getting Started</h2>
<h4 id="were-happy-to-announce-that-subscriptions-are-now-available-for-all-scaphold-apps">We're happy to announce that subscriptions are now available for all Scaphold Apps!</h4>
<p>We have worked closely with the Apollo Team to remove all the friction from building realtime applications using GraphQL! Here is quick guide on how you can easily start building realtime apps <strong>for free</strong> using Apollo Client and Scaphold.io!</p>
<p>1) Go to Scaphold.io and create a free app!</p>
<p>2) That's it! You now have a fully featured, realtime GraphQL API ready to power your app!</p>
<p>Okay so it really is that easy, but let's make things a little more interesting!</p>
<p>Let's create a data model for our Slackr app!</p>
<h4 id="design-our-data-model">Design our Data Model</h4>
<p>This is one area where Scaphold excels over previous realtime BaaS offerings like Firebase. Although Firebase has powerful primitives for building realtime apps, they lack the ability to define powerful data models. Our use of GraphQL allows us to provides the best of both worlds. By leveraging GraphQL, we can provide millisecond subscription latencies for simple queries as well as allow you to define much more complex queries that will be rerun on every update. This can be much more efficient than exising solutions as you can often get all the data you want pushed to you in realtime without having to issue any other requests.</p>
<p>Let's try this out by defining the data model for our <strong>Slackr</strong> app. Our app will be like a dumbed down version of slack. A user can subscribe to any number of public channels and each channel can contain any number of messages each of which has an author.</p>
<p>Here is a simplified version of our data model in GraphQL schema language.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>type User {
    id: ID!
    username: String!
    nickname: String
    picture: String
    messages: MessageConnection
    channels: ChannelConnection
}

type Message {
    id: ID!
    content: String!
    author: User!
    channel: Channel!
}

type Channel {
    id: ID!
    name: String!
    members: UserConnection
    messages: MessageConnection
}

# Note: A Connection is a paginated relation. This allows us to connect
# arbitrarily large sets of objects with one another
</pre></div>
</td></tr></table>

<p>To aid you in developing your application's data model, Scaphold comes with a graphical schema designer. As you make changes to your schema, the infrastructure behind the scenes will automatically update to match the new schema. There is a lot you can do with the schema designer including creating Interfaces, Enums, defining permissions, and more. To start, let's just create a few types, add some fields, and create relations between your types via <strong>Connection</strong> fields.</p>
<p>Creating your schema is easy! Here is me doing it!</p>
<p><img alt="" src="https://assets.scaphold.io/tutorials/slackr/configure2.gif" /></p>
<p><strong>This is what I did</strong></p>
<p>1) Using the schema designer, create two new types <strong>Message</strong> and <strong>Channel</strong></p>
<p>2) On the <strong>Channel</strong> type add the fields</p>
<ul>
<li>
<p><code>name</code> with type <code>String</code>.</p>
</li>
<li>
<p><code>messages</code> with type <code>Connection</code>, ofType <code>Message</code>, reverseName <code>channel</code>, and cardinality <code>One to Many</code>.</p>
</li>
<li>
<p><code>members</code> with type <code>Connection</code>, ofType <code>User</code>, reverseName <code>channels</code>, and cardinality <code>Many To Many</code>.</p>
</li>
<li>
<p><code>isPublic</code> with type <code>Boolean</code> and a defaultValue of <code>false</code>.</p>
</li>
</ul>
<p>3) On the <strong>Message</strong> type, add the fields</p>
<ul>
<li>
<p><code>content</code> with type <code>String</code>.</p>
</li>
<li>
<p><code>author</code> with type <code>Connection</code>, ofType <code>User</code>, reverseName <code>messages</code>, and cardinality <code>Many To One</code> with the Many on the Message side.</p>
</li>
</ul>
<p>4) On the <strong>User</strong> type, add the fields:</p>
<ul>
<li>
<p><code>nickname</code> with type <code>String</code></p>
</li>
<li>
<p><code>picture</code> with type <code>String</code></p>
</li>
</ul>
<p>That should do it! As we were poking around and adding types, fields, and relations the infrastrucutre needed to power your app was automatically deployed and configured for your new schema. We have now done all the setup that is necessary to start building our application. To get a feel for what capabilities our new API has in store, let's jump over to GraphiQL to explore our API and prototype some queries.</p>
<h4 id="exploring-your-api-in-graphiql">Exploring your API in GraphiQL</h4>
<p>As we said earlier, Subscriptions are reactions to mutations made elsewhere. Before diving into building our front-end we can play with our new realtime subscriptions using GraphiQL. Here is what it looks like:</p>
<p><img alt="" src="http://assets.scaphold.io/tutorials/slackr/subs2.gif" /></p>
<p>We first issue a subcription query (seen below) and can then watch as changes are pushed to us from the server whenever we create new messages.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>subscription SubscribeToNewMessage($messageFilter: MessageWhereArgs) {
    subscribeToNewMessage(mutations:[createMessage], where: $messageFilter) {
        mutation
        value {
            id
            content
            author {
                id
                username
            }
        }
    }
}
</pre></div>
</td></tr></table>

<p>Notice that this subscription query is slightly different than the subscription query I showed before. See how we are asking for the nested <code>author</code> id and username? This is a simple example showing the power that comes from combining realtime data with a structured data model. Not only will our client application receive an update within milliseconds of a new <strong>Message</strong> being created but it will also automatically receive the related <code>author</code> of the <strong>Message</strong> without having to issue another request. This is just one example that shows how GraphQL can make your applications not only more efficient but easier to develop.</p>
<p>Under the hood, a websocket connection is being established between our Apollo Client instance and Scaphold's webservers. This connection stays open as long as our subscription is alive and acts as the transport that allows the server to send updates to the client.</p>
<p>The pane that pops out from the right of GraphiQL will show all new messages that satisfy our filter. To see it in action lets call the <code>createMessage</code> mutation to create a new <strong>Message</strong> object.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>mutation CreateMessage($message: CreateMessageInput!) {
    createMessage(input: $message) {
        changedMessage {
            id
            content
        }
    }
}
</pre></div>
</td></tr></table>

<p>Each time you create a new object that satisfies your subscription filter, you should see a new object appear in the pane to the right! That new message was pushed to us from the server in realtime! Each message should also come with the associated user attached so you can easily present user information alongside the message in your UI!</p>
<p>Take some time to play around with your new API! It has a bunch of goodies hidden in it so poke around the doc explorer to see what it has to offer! For starters, we've generated a GraphQL Subscription for each type that you have in your data model.</p>
<h3 id="connecting-to-your-api-from-your-application">Connecting to your API from your application</h3>
<p>The Scaphold GraphiQL page has already implemented the subscription protocol for you. The good news is that it is really easy to set this up in your own application. Here is how.</p>
<p>1) Download Apollo Client from npm! (Apollo Client works pretty much the same whether you are building a React, AngularJS, or vanilla JavaScript applications)</p>
<ul>
<li>
<p><code>npm install apollo-client graphql-tag --save</code></p>
</li>
<li>
<p>If using React also <code>npm install react-apollo --save</code></p>
</li>
<li>
<p>If using Angular2 also <code>npm install angular2-apollo --save</code></p>
</li>
</ul>
<p>2) Configure the Apollo Client network layer to work with websockets. To do this we can use the following two code snippets:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">/*</span> <span class="n">File</span><span class="p">:</span> <span class="n">addGraphQLSubscriptions</span><span class="o">.</span><span class="n">js</span> <span class="o">*/</span>

<span class="kn">import</span> <span class="p">{</span> <span class="k">print</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;graphql-tag/printer&#39;</span><span class="p">;</span>

<span class="o">//</span> <span class="n">quick</span> <span class="n">way</span> <span class="n">to</span> <span class="n">add</span> <span class="n">the</span> <span class="n">subscribe</span> <span class="ow">and</span> <span class="n">unsubscribe</span> <span class="n">functions</span> <span class="n">to</span> <span class="n">the</span> <span class="n">network</span> <span class="n">interface</span>
<span class="n">export</span> <span class="n">default</span> <span class="n">function</span> <span class="n">addGraphQLSubscriptions</span><span class="p">(</span><span class="n">networkInterface</span><span class="p">,</span> <span class="n">wsClient</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">Object</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">networkInterface</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">subscribe</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">wsClient</span><span class="o">.</span><span class="n">subscribe</span><span class="p">({</span>
        <span class="n">query</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">query</span><span class="p">),</span>
        <span class="n">variables</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">variables</span><span class="p">,</span>
      <span class="p">},</span> <span class="n">handler</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="n">unsubscribe</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">wsClient</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="nb">id</span><span class="p">);</span>
    <span class="p">},</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="o">/*</span> <span class="n">End</span> <span class="n">of</span> <span class="nb">file</span><span class="p">:</span> <span class="n">addGraphQLSubscriptions</span><span class="o">.</span><span class="n">js</span> <span class="o">*/</span>
</pre></div>
</td></tr></table>

<p>The <code>addGraphQLSubscriptions</code> function retrofits the Apollo Client network interface with the subscribe and unsubscribe methods that we can use from our application code.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">/*</span> <span class="n">File</span><span class="p">:</span> <span class="n">makeApolloClient</span><span class="o">.</span><span class="n">js</span> <span class="o">*/</span>

<span class="kn">import</span> <span class="nn">addGraphQLSubscriptions</span> <span class="nn">from</span> <span class="s1">&#39;./addGraphQLSubscriptions&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">ApolloClient</span><span class="o">,</span> <span class="p">{</span> <span class="n">createNetworkInterface</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;apollo-client&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">Client</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;subscriptions-transport-ws&#39;</span><span class="p">;</span>

<span class="o">//</span> <span class="n">creates</span> <span class="n">a</span> <span class="n">subscription</span> <span class="n">ready</span> <span class="n">Apollo</span> <span class="n">Client</span> <span class="n">instance</span>
<span class="n">export</span> <span class="n">function</span> <span class="n">makeApolloClient</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">scapholdUrl</span> <span class="o">=</span> <span class="s1">&#39;v2.api.scaphold.io/graphql/my-awesome-app&#39;</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">graphqlUrl</span> <span class="o">=</span> <span class="sb">`https://${scapholdUrl}`</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">websocketUrl</span> <span class="o">=</span> <span class="sb">`wss://${scapholdUrl}`</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">networkInterface</span> <span class="o">=</span> <span class="n">createNetworkInterface</span><span class="p">(</span><span class="n">graphqlUrl</span><span class="p">);</span>
  <span class="n">networkInterface</span><span class="o">.</span><span class="n">use</span><span class="p">([{</span>
    <span class="n">applyMiddleware</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="nb">next</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">//</span> <span class="n">Easy</span> <span class="n">way</span> <span class="n">to</span> <span class="n">add</span> <span class="n">authorization</span> <span class="n">headers</span> <span class="k">for</span> <span class="n">every</span> <span class="n">request</span>
      <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">req</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">req</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{};</span>  <span class="o">//</span> <span class="n">Create</span> <span class="n">the</span> <span class="n">header</span> <span class="nb">object</span> <span class="k">if</span> <span class="n">needed</span><span class="o">.</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">localStorage</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s1">&#39;scaphold_user_token&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">how</span> <span class="n">to</span> <span class="n">authorize</span> <span class="n">users</span> <span class="n">using</span> <span class="n">http</span> <span class="n">auth</span> <span class="n">headers</span>
        <span class="n">req</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">Authorization</span> <span class="o">=</span> <span class="sb">`Bearer ${localStorage.getItem(&#39;scaphold_user_token&#39;)}`</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nb">next</span><span class="p">();</span>
    <span class="p">},</span>
  <span class="p">}]);</span>
  <span class="n">const</span> <span class="n">wsClient</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Client</span><span class="p">(</span><span class="n">websocketUrl</span><span class="p">);</span>
  <span class="n">const</span> <span class="n">networkInterfaceWithSubscriptions</span> <span class="o">=</span> <span class="n">addGraphQLSubscriptions</span><span class="p">(</span><span class="n">networkInterface</span><span class="p">,</span> <span class="n">wsClient</span><span class="p">);</span>

  <span class="n">const</span> <span class="n">clientGraphql</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ApolloClient</span><span class="p">({</span>
    <span class="n">networkInterface</span><span class="p">:</span> <span class="n">networkInterfaceWithSubscriptions</span><span class="p">,</span>
    <span class="n">initialState</span><span class="p">:</span> <span class="p">{},</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="n">clientGraphql</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">/*</span> <span class="n">End</span> <span class="n">of</span> <span class="n">File</span><span class="p">:</span> <span class="n">makeApolloClient</span><span class="o">.</span><span class="n">js</span> <span class="o">*/</span>
</pre></div>
</td></tr></table>

<p>The <code>makeApolloClient</code> function then creates a new Apollo Client instance, applies the subscription methods, and adds a peice of authentication middleware before returning the client for use in our application.</p>
<p>This is all we need to do to configure our Apollo Client instance for subscriptions.</p>
<h3 id="using-subscriptions-from-vanilla-js">Using subscriptions from vanilla js</h3>
<p>Using subscriptions from our application could not be much simpler. At Scaphold, we build our user interfaces with React, but Apollo Client works with any javascript frontend. Here is an unopinionated example.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">makeApolloClient</span> <span class="nn">from</span> <span class="s1">&#39;./makeApolloClient&#39;</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Make</span> <span class="n">our</span> <span class="n">apollo</span> <span class="n">client</span> <span class="n">instance</span>
<span class="n">const</span> <span class="n">client</span> <span class="o">=</span> <span class="n">makeApolloClient</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Our</span> <span class="n">subscription</span> <span class="n">query</span>
<span class="n">const</span> <span class="n">subscriptionQuery</span> <span class="o">=</span> <span class="err">`</span>
<span class="n">subscription</span> <span class="n">SubscribeToNewMessage</span><span class="p">(</span><span class="err">$</span><span class="n">messageFilter</span><span class="p">:</span> <span class="n">MessageWhereArgs</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">subscribeToNewMessage</span><span class="p">(</span><span class="n">mutations</span><span class="p">:[</span><span class="n">createMessage</span><span class="p">],</span> <span class="n">where</span><span class="p">:</span> <span class="err">$</span><span class="n">messageFilter</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">mutation</span>
        <span class="n">value</span> <span class="p">{</span>
            <span class="nb">id</span>
            <span class="n">content</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="err">`</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Our</span> <span class="n">subscription</span> <span class="nb">filter</span>
<span class="n">const</span> <span class="nb">vars</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">messageFilter</span><span class="p">:</span> <span class="p">{</span>
    <span class="n">content</span><span class="p">:</span> <span class="p">{</span>
      <span class="n">channelId</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">eq</span><span class="p">:</span> <span class="s1">&#39;AChannelId&#39;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="o">//</span> <span class="n">Initiate</span> <span class="n">the</span> <span class="n">subscription</span> <span class="n">observable</span>
<span class="n">const</span> <span class="n">subscriptionObservable</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">subscribe</span><span class="p">({</span>
  <span class="n">query</span><span class="p">:</span> <span class="n">subscriptionQuery</span><span class="p">,</span>
  <span class="n">variables</span><span class="p">:</span> <span class="nb">vars</span><span class="p">,</span>
<span class="p">});</span>

<span class="o">//</span> <span class="n">Use</span> <span class="n">observable</span><span class="o">.</span><span class="n">subscribe</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">new</span> <span class="n">data</span> <span class="n">pushed</span> <span class="kn">from</span> <span class="nn">the</span> <span class="nn">server</span> <span class="nn">and</span> <span class="nn">errors.</span>
<span class="n">const</span> <span class="n">messageSubscription</span> <span class="o">=</span> <span class="n">subscriptionObservable</span><span class="o">.</span><span class="n">subscribe</span><span class="p">({</span>
  <span class="nb">next</span><span class="p">(</span><span class="n">newObj</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Received new data&#39;</span><span class="p">);</span>
    <span class="o">//</span> <span class="n">Merge</span> <span class="n">the</span> <span class="n">new</span> <span class="n">data</span> <span class="k">with</span> <span class="n">our</span> <span class="n">client</span> <span class="n">side</span> <span class="n">data</span> <span class="n">cache</span><span class="o">.</span> <span class="n">See</span> <span class="n">Below</span> <span class="o">*</span>
  <span class="p">},</span>
  <span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sb">`Error Subscribing: ${err.message}`</span><span class="p">);</span>
  <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p>First you can see that we have provided a GraphQL query and variables to Apollo's GraphQL function to initiate the subscription. In this case we are only interested in new posts that belong to the channel with id 'MyChannelId'. In reality, the <code>channelId</code> would be a base64 encoded string created automatically when you create a <strong>Channel</strong> but this works for demonstration purposes. If you take a look in the doc explorer you will see that in addition to the <code>eq</code> operator, you can specify a list of channel ids to include or exclude using the <code>in</code> and <code>notIn</code> operators.</p>
<blockquote>
<p>Note: The above example uses the default <code>subscribe</code> method to listen for updates. There is also a higher-level, <code>subscribeToMore</code> method that manages more for us. E.G. it will keep track of open subscriptions and automatically close them for us. It also allows you to pass in a <code>updateQuery</code> function that lets you define how you would like to merge the new data with the cache.</p>
</blockquote>
<h5 id="merging-changes-with-the-client-side-cache">Merging changes with the client side cache</h5>
<p>An important topic to discuss when it comes to subscriptions is how to merge new data pushed from the server with the client side cache. There are many ways to do this and it often changes from application to application. At Scaphold, we use <a href="https://facebook.github.io/immutable-js/">ImmutableJS</a> data structures and <a href="http://redux.js.org/">redux</a> alongside the Apollo Client managed cache but this is largely up to you.</p>
<p>Apollo Client does a lot really nice things for you that can mostly eliminate the need to do any custom work. The key to merging changes with the Apollo cache is the <code>updateQuery</code> method passed to <code>subscribeToMore</code>. To see an example of this let's take a snippet from our <strong>Slackr</strong> React application.</p>
<h3 id="using-subscriptions-from-react">Using Subscriptions from React</h3>
<p>Let's look at a more real world example using react. Apollo comes packed with really nice react-binding that we can use to simplify the process of subscribing to data and merging new data into the client side cache.</p>
<p>Here is a condensed example from our Slackr app.</p>
<p><a href="https://github.com/scaphold-io/slackr-graphql-subscriptions-starter-kit/blob/master/src/components/messages.jsx">See the complete code on GitHub</a></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">React</span> <span class="nn">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">graphql</span><span class="p">,</span> <span class="n">compose</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;react-apollo&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">gql</span> <span class="nn">from</span> <span class="s1">&#39;graphql-tag&#39;</span><span class="p">;</span>

<span class="n">const</span> <span class="n">ChannelMessagesQuery</span> <span class="o">=</span> <span class="n">gql</span><span class="err">`</span>
<span class="n">query</span> <span class="n">GetPublicChannels</span><span class="p">(</span><span class="err">$</span><span class="n">channelId</span><span class="p">:</span> <span class="n">ID</span><span class="err">!</span><span class="p">,</span> <span class="err">$</span><span class="n">messageOrder</span><span class="p">:</span> <span class="p">[</span><span class="n">MessageOrderByArgs</span><span class="p">])</span> <span class="p">{</span>
  <span class="n">getChannel</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="err">$</span><span class="n">channelId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">id</span>
    <span class="n">name</span>
    <span class="n">messages</span><span class="p">(</span><span class="n">last</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="n">orderBy</span><span class="p">:</span> <span class="err">$</span><span class="n">messageOrder</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">edges</span> <span class="p">{</span>
        <span class="n">node</span> <span class="p">{</span>
          <span class="nb">id</span>
          <span class="n">content</span>
          <span class="n">createdAt</span>
          <span class="n">author</span> <span class="p">{</span>
            <span class="nb">id</span>
            <span class="n">username</span>
            <span class="n">nickname</span>
            <span class="n">picture</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="err">`</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Messages</span> <span class="n">extends</span> <span class="n">React</span><span class="o">.</span><span class="n">Component</span> <span class="p">{</span>

    <span class="o">...</span>

    <span class="n">componentWillReceiveProps</span><span class="p">(</span><span class="n">newProps</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="err">!</span><span class="n">newProps</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loading</span> <span class="o">&amp;&amp;</span>
            <span class="n">newProps</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">getChannel</span>
        <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="err">!</span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">getChannel</span> <span class="o">||</span>
                <span class="n">newProps</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">getChannel</span><span class="o">.</span><span class="n">id</span> <span class="o">!==</span> <span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">getChannel</span><span class="o">.</span><span class="n">id</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="o">//</span> <span class="n">If</span> <span class="n">we</span> <span class="n">change</span> <span class="n">channels</span><span class="p">,</span> <span class="n">subscribe</span> <span class="n">to</span> <span class="n">the</span> <span class="n">new</span> <span class="n">channel</span>
                <span class="n">this</span><span class="o">.</span><span class="n">subscribeToNewMessages</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="o">/*</span>
    <span class="o">*</span>   <span class="n">Initiates</span> <span class="n">the</span> <span class="n">subscription</span> <span class="ow">and</span> <span class="n">specifies</span> <span class="n">how</span> <span class="n">new</span> <span class="n">data</span> <span class="n">should</span> <span class="n">be</span> <span class="n">merged</span>
    <span class="o">*</span>   <span class="n">into</span> <span class="n">the</span> <span class="n">cache</span> <span class="n">using</span> <span class="n">the</span> <span class="n">updateQuery</span> <span class="n">method</span><span class="o">.</span>
    <span class="o">*/</span>
    <span class="n">subscribeToNewMessages</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">subscription</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">subscribeToMore</span><span class="p">({</span>
            <span class="n">document</span><span class="p">:</span> <span class="n">gql</span><span class="err">`</span>
                <span class="n">subscription</span> <span class="n">newMessages</span><span class="p">(</span><span class="err">$</span><span class="n">subscriptionFilter</span><span class="p">:</span><span class="n">MessageSubscriptionFilter</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">subscribeToMessage</span><span class="p">(</span><span class="n">mutations</span><span class="p">:[</span><span class="n">createMessage</span><span class="p">],</span> <span class="nb">filter</span><span class="p">:</span> <span class="err">$</span><span class="n">subscriptionFilter</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">value</span> <span class="p">{</span>
                            <span class="nb">id</span>
                            <span class="n">content</span>
                            <span class="n">createdAt</span>
                            <span class="n">author</span> <span class="p">{</span>
                                <span class="nb">id</span>
                                <span class="n">username</span>
                                <span class="n">nickname</span>
                                <span class="n">picture</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="err">`</span><span class="p">,</span>
            <span class="n">variables</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">subscriptionFilter</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">channelId</span><span class="p">:</span> <span class="p">{</span>
                        <span class="o">//</span> <span class="n">We</span><span class="s1">&#39;re using react-router and grabbing the channelId from the url</span>
                        <span class="o">//</span> <span class="n">to</span> <span class="n">designate</span> <span class="n">which</span> <span class="n">channel</span> <span class="n">to</span> <span class="n">subscribe</span> <span class="n">to</span>
                        <span class="n">eq</span><span class="p">:</span> <span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">params</span> <span class="err">?</span> <span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">channelId</span> <span class="p">:</span> <span class="n">null</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>

            <span class="o">/*</span>
            <span class="o">*</span>    <span class="n">Update</span> <span class="n">query</span> <span class="n">specifies</span> <span class="n">how</span> <span class="n">the</span> <span class="n">new</span> <span class="n">data</span> <span class="n">should</span> <span class="n">be</span> <span class="n">merged</span>
            <span class="o">*</span>    <span class="k">with</span> <span class="n">our</span> <span class="n">previous</span> <span class="n">results</span><span class="o">.</span> <span class="n">Note</span> <span class="n">how</span> <span class="n">the</span> <span class="n">structure</span> <span class="n">of</span> <span class="n">the</span>
            <span class="o">*</span>    <span class="nb">object</span> <span class="n">we</span> <span class="k">return</span> <span class="n">here</span> <span class="n">directly</span> <span class="n">matches</span> <span class="n">the</span> <span class="n">structure</span> <span class="n">of</span>
            <span class="o">*</span>    <span class="n">the</span> <span class="n">GetPublicChannels</span> <span class="n">query</span><span class="o">.</span>
            <span class="o">*/</span>
            <span class="n">updateQuery</span><span class="p">:</span> <span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="p">{</span> <span class="n">subscriptionData</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="n">const</span> <span class="n">newEdges</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="o">...</span><span class="n">prev</span><span class="o">.</span><span class="n">getChannel</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="n">node</span><span class="p">:</span> <span class="p">{</span>
                            <span class="o">...</span><span class="n">subscriptionData</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">subscribeToMessage</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">];</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="n">getChannel</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">messages</span><span class="p">:</span> <span class="p">{</span>
                            <span class="n">edges</span><span class="p">:</span> <span class="n">newEdges</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">};</span>
            <span class="p">},</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="o">...</span>
<span class="p">}</span>

<span class="n">const</span> <span class="n">MessagesWithData</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span>
  <span class="n">graphql</span><span class="p">(</span><span class="n">ChannelMessagesQuery</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">options</span><span class="p">:</span> <span class="p">(</span><span class="n">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="n">const</span> <span class="n">channelId</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">params</span> <span class="err">?</span> <span class="n">props</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">channelId</span> <span class="p">:</span> <span class="n">null</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="n">returnPartialData</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="n">variables</span><span class="p">:</span> <span class="p">{</span>
          <span class="n">channelId</span><span class="p">,</span>
          <span class="n">messageOrder</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="n">field</span><span class="p">:</span> <span class="s1">&#39;createdAt&#39;</span><span class="p">,</span>
              <span class="n">direction</span><span class="p">:</span> <span class="s1">&#39;ASC&#39;</span>
            <span class="p">}</span>
          <span class="p">],</span>
        <span class="p">},</span>
      <span class="p">};</span>
    <span class="p">},</span>
  <span class="p">}),</span>
  <span class="o">...</span> <span class="o">//</span> <span class="n">We</span> <span class="n">compose</span> <span class="n">a</span> <span class="n">few</span> <span class="n">more</span> <span class="n">queries</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">actual</span> <span class="n">app</span><span class="o">.</span>
<span class="p">)(</span><span class="n">Messages</span><span class="p">);</span>

<span class="n">export</span> <span class="n">default</span> <span class="n">MessagesWithData</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>A few things are going on here. To make sense of what is happening, let's start from the logical beginning which actually occurs at the end of the file. See this line <code>const MessagesWithData = compose(graphql(ChannelMessagesQuery, ...));</code> towards the bottom of the snippet? This is the standard way to use Apollo to connect a React component with data from a GraphQL query. The <code>graphql</code> function will wrap our component in a higher-order component that grabs our data and makes it available to our component via its <code>props</code>. In this example, we will be able to access our <strong>Channel</strong> data from our component with <code>this.props.data.getChannel</code> as soon as it is fetched.</p>
<blockquote>
<p>Note: The <code>returnPartialData: true</code> option is important. When you want to use <code>subscribeToMore</code> to merge results into the result of a normal query it is necessary to specify this.</p>
</blockquote>
<p>Okay so we have connected our component with a regular old GraphQL query, but how do we make it realtime? The key is the method <code>subscribeToMore</code>.  Look at our <code>subscribeToNewMessages</code> method. Apollo's <code>graphql</code> function fits our component with the data prop that exposes the <code>subscribeToMore</code> method. We use this method to attach a subscription query which then calls the <code>updateQuery</code> method we pass in every time a new peice of data is pushed from the server. The object we return from <code>updateQuery</code> is then merged with our previous results and persisted in the client side cache. This way, <code>this.props.data.getChannel...</code> is always kept up to date and we can use it like normal to render our UI.</p>
<p>Take a minute to look over this file. Apollo does a great job allowing us to use realtime subscriptions alongside traditional queries and mutations. The combination of <code>subscribeToMore</code> and <code>updateQuery</code> offer a powerful set of tools to keep our UI up to date when dealing with realtime data!</p>
<h2 id="user-authentication">User Authentication</h2>
<p>We have now covered the basics of how to use GraphQL subscriptions from both vanilla JS as well as React. We're now ready to finish up the surface area of our application! One of the nice things Scaphold does for you is handling user authentication. There is also an auth0 integration that lets you easily add social auth to any application instantly. In our Slackr app, we have enabled GitHub login so user's can easily chime in on our app without having to create any messy usernames or password.</p>
<p>Authentication with a Scaphold API is done via the <code>Authorization</code> http header. We use <a href="https://jwt.io/">JSON Web Tokens</a> to securely authenticate your users and have integrations that allow you to pull in the auth provider of your choice. You've actually already seen how to add authentication to Apollo Client.</p>
<p>Remember this from makeApolloClient.js?</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cm">/* File: makeApolloClient.js */</span>
<span class="kr">const</span> <span class="nx">networkInterface</span> <span class="o">=</span> <span class="nx">createNetworkInterface</span><span class="p">(</span><span class="nx">graphqlUrl</span><span class="p">);</span>
<span class="nx">networkInterface</span><span class="p">.</span><span class="nx">use</span><span class="p">([{</span>
    <span class="nx">applyMiddleware</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Easy way to add authorization headers for every request</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">headers</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">req</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="p">{};</span>  <span class="c1">// Create the header object if needed.</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;scaphold_user_token&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// This is how to authorize users using http auth headers</span>
            <span class="nx">req</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">Authorization</span> <span class="o">=</span> <span class="sb">`Bearer </span><span class="si">${</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;scaphold_user_token&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">next</span><span class="p">();</span>
    <span class="p">},</span>
<span class="p">}]);</span>
</pre></div>
</td></tr></table>

<p>This auth middleware looks for a token names 'scaphold_user_token' in the browser's local storage and then appends the necessary auth header to each request. This is great because all we need to do is pick a authentication mechanism and then save the token we get back from logging in to local storage and the middleware will handle the rest.</p>
<h4 id="social-authentication-for-any-application">Social authentication for any application</h4>
<p><strong>Slackr</strong> uses Auth0 lock for easy authentication. To make this work, we must first add the Auth0 integration to our API on Scaphold. It's easy!</p>
<p>1) Go to <a href="https://auth0.com">Auth0</a> and create a free account.</p>
<p>2) Under the Social connections tab on the left, enable GitHub as an oauth provider.
    - You will need to create a GitHub application to get the clientId and secret to give to Auth0.</p>
<p>3) From the clients tab on the left in Auth0, open your application and grab your Auth0 clientId and client secret.</p>
<p>4) Go to Scaphold's integrations page and enter the clientId and client secret in a new Auth0 integration.</p>
<p>5) Presto chango, your API is now ready to handle social authentication!</p>
<p>One easy way to add authentication to your client app is by using Auth0 Lock. Lock is essentially a smart sign-in form that you can drop into any web or mobile application. You use Lock to handle the OAuth and then you can link the social credential with Scaphold's API using the <code>loginWithAuth0Lock</code> mutation that is now available in your API.</p>
<p>For a full example of how to do this take a look at <a href="https://github.com/scaphold-io/slackr-graphql-subscriptions-starter-kit/blob/master/src/utilities/auth.js">auth.js</a> and <a href="https://github.com/scaphold-io/slackr-graphql-subscriptions-starter-kit/blob/master/src/components/channels.jsx">channels.jsx</a> in our <strong>Slackr</strong> app starter kit.</p>
<p>The login flow is simple. First we open lock, the user then enters his or her credentials or chooses from a set of social auth providers, and then Lock handles the OAuth handshake and returns a login credential. We then make one more call to Auth0 to grab the auth0 profile and then we send the auth0 user identity to Scaphold's servers where it is then matched with a Scaphold user. As part of the <code>loginWithAuth0Lock</code> mutation payload, Scaphold will return the auth token that is to be stored in local storage on the client and attached to http requests as the Authorization header by the Apollo Client auth middleware.</p>
<h2 id="wrapping-up">Wrapping Up</h2>
<p>Congrats! Now you've seen how you can use Scaphold, Apollo, and GraphQL subscriptions to build realtime, real-world applications in a fraction of the time it used to. To review what we did, we...</p>
<ol>
<li>
<p>Defined our applications data model using Scaphold's Graphical Schema Designer and a realtime GraphQL API was automatically configured and deployed for us.</p>
</li>
<li>
<p>As soon as we finished designing our schema, we jumped over to GraphiQL to prototype our subscriptions query and saw data pushed to us in realitme.</p>
</li>
<li>
<p>We discussed how you can easily add realtime subscriptions to you own application using Apollo Client.</p>
</li>
<li>
<p>Last, we added social authentication to our API via the Auth0 Integration to allow our users to login via GitHub.</p>
</li>
</ol>
<p>This is a great start but there is still alot we could do. We could start by adding permissions to our data for fine-grained access control which would allow us to create private channels. We could also instantly add iOS and Android push notifications so that we can alert our users when our application is closed. Stay tuned for more updates as more features come out daily!</p>
<p>Happy Scapholding!</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../app-management/token-expiration/" title="Token Expiration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Token Expiration
              </span>
            </div>
          </a>
        
        
          <a href="../sending-push-notifications/" title="Sending Push Notifications" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Sending Push Notifications
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-7aa26ad9ec.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>