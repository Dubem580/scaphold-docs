
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content=""Learn how to easily migrate MongoDB to GraphQL!"">
      
      
      
        <meta name="author" content=""Michael Paris"">
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.2, mkdocs-material-1.3.0">
    
    
      
        <title>Migrating from MongoDB to GraphQL</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-1d1da4857d.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/base.css">
    
      <link rel="stylesheet" href="../../css/styles.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="Scaphold Docs" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Tutorials
                </span>
              
            
            Migrating MongoDB
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/scaphold-io/scaphold-docs" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Scaphold Docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/scaphold-io/scaphold-docs" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/jumpstart-video/" title="Jumpstart Video" class="md-nav__link">
      Jumpstart Video
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/starter-kits/" title="Starter Kits" class="md-nav__link">
      Starter Kits
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/schema/" title="The Schema" class="md-nav__link">
      The Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/queries/" title="Queries" class="md-nav__link">
      Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/mutations/" title="Mutations" class="md-nav__link">
      Mutations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/subscriptions/" title="Subscriptions" class="md-nav__link">
      Subscriptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/connections-pagination/" title="Connections" class="md-nav__link">
      Connections
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Authentication
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Authentication
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication/tokens/" title="Auth Tokens" class="md-nav__link">
      Auth Tokens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication/permissions/" title="Permissions" class="md-nav__link">
      Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication/social/" title="Social Auth" class="md-nav__link">
      Social Auth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication/super-users/" title="Super Users" class="md-nav__link">
      Super Users
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Realtime Subscriptions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Realtime Subscriptions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime/subscriptions-apollo/" title="Subscriptions With Apollo Client" class="md-nav__link">
      Subscriptions With Apollo Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime/subscriptions-react/" title="Subscriptions With React" class="md-nav__link">
      Subscriptions With React
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime/slackr-chat-app/" title="Build Slack Tutorial" class="md-nav__link">
      Build Slack Tutorial
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Custom Logic
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Custom Logic
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/composition/" title="Function Composition" class="md-nav__link">
      Function Composition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/pre-operations/" title="Pre Operations" class="md-nav__link">
      Pre Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/operation-phase/" title="Operation Phase" class="md-nav__link">
      Operation Phase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/post-operations/" title="Post Operations" class="md-nav__link">
      Post Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/async-operations/" title="Async Operations" class="md-nav__link">
      Async Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/logs/" title="Logs & Examples" class="md-nav__link">
      Logs & Examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Persisted Queries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Persisted Queries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../persisted-queries/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../persisted-queries/getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../persisted-queries/querying-from-client/" title="Querying From Client" class="md-nav__link">
      Querying From Client
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Files
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Files
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../files/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../files/uploading/" title="Uploading" class="md-nav__link">
      Uploading
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../files/querying/" title="Querying" class="md-nav__link">
      Querying
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Integrations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/email/" title="Email" class="md-nav__link">
      Email
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/passwordless/" title="Passwordless Auth" class="md-nav__link">
      Passwordless Auth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/push/" title="Push Notifications" class="md-nav__link">
      Push Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-6" type="checkbox" id="nav-9-6">
    
    <label class="md-nav__link" for="nav-9-6">
      Search
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-6">
        Search
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/search/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/search/querying/" title="Querying" class="md-nav__link">
      Querying
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-7" type="checkbox" id="nav-9-7">
    
    <label class="md-nav__link" for="nav-9-7">
      Social Auth
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-7">
        Social Auth
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/social/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/social/login-with-native/" title="Login With Native SDKs" class="md-nav__link">
      Login With Native SDKs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/social/login-with-auth0/" title="Login With Auth0" class="md-nav__link">
      Login With Auth0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      App Management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        App Management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/alias/" title="Aliases" class="md-nav__link">
      Aliases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/analytics/" title="Analytics" class="md-nav__link">
      Analytics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/export-schema/" title="Export Schema" class="md-nav__link">
      Export Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/fork-app/" title="Fork App" class="md-nav__link">
      Fork App
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/teams/" title="Teams" class="md-nav__link">
      Teams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/multi-region/" title="Multi Region" class="md-nav__link">
      Multi Region
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/admin-tokens/" title="Admin Tokens" class="md-nav__link">
      Admin Tokens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/token-expiration/" title="Token Expiration" class="md-nav__link">
      Token Expiration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" checked>
    
    <label class="md-nav__link" for="nav-11">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../realtime-apps-with-subscriptions/" title="Build A Chat App" class="md-nav__link">
      Build A Chat App
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sending-push-notifications/" title="Sending Push Notifications" class="md-nav__link">
      Sending Push Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ios-push-notifications/" title="Setup iOS Push" class="md-nav__link">
      Setup iOS Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../android-push-notifications/" title="Setup Android Push" class="md-nav__link">
      Setup Android Push
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Migrating MongoDB
      </label>
    
    <a href="./" title="Migrating MongoDB" class="md-nav__link md-nav__link--active">
      Migrating MongoDB
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-define-the-schema" title="Step 1: Define the schema" class="md-nav__link">
    Step 1: Define the schema
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-schema-on-scapholdio" title="Deploy the schema on Scaphold.io" class="md-nav__link">
    Deploy the schema on Scaphold.io
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-migration-script" title="The migration script" class="md-nav__link">
    The migration script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-the-migration" title="Test the migration" class="md-nav__link">
    Test the migration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrating-more-complicated-data" title="Migrating more complicated data" class="md-nav__link">
    Migrating more complicated data
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thanks-for-reading" title="Thanks for reading!" class="md-nav__link">
    Thanks for reading!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../persisted-queries/" title="Using Persisted Queries" class="md-nav__link">
      Using Persisted Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-queries/" title="Advanced Relational Queries" class="md-nav__link">
      Advanced Relational Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../authentication-in-graphql/" title="Authentication in GraphQL" class="md-nav__link">
      Authentication in GraphQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../search-with-algolia/" title="Add Search With Algolia" class="md-nav__link">
      Add Search With Algolia
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aggregations-in-graphql/" title="Aggregations In GraphQL" class="md-nav__link">
      Aggregations In GraphQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../apollo-optics-graphql-server/" title="Integrate Apollo Optics" class="md-nav__link">
      Integrate Apollo Optics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../adding-social-auth/" title="Add Social Auth" class="md-nav__link">
      Add Social Auth
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../errors/" title="Errors" class="md-nav__link">
      Errors
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-define-the-schema" title="Step 1: Define the schema" class="md-nav__link">
    Step 1: Define the schema
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-schema-on-scapholdio" title="Deploy the schema on Scaphold.io" class="md-nav__link">
    Deploy the schema on Scaphold.io
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-migration-script" title="The migration script" class="md-nav__link">
    The migration script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-the-migration" title="Test the migration" class="md-nav__link">
    Test the migration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrating-more-complicated-data" title="Migrating more complicated data" class="md-nav__link">
    Migrating more complicated data
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thanks-for-reading" title="Thanks for reading!" class="md-nav__link">
    Thanks for reading!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/scaphold-io/scaphold-docs/edit/master/docs/tutorials/migrate-mongodb-graphql.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                
                
                <h1 id="migrating-from-mongodb-to-graphql">Migrating from MongoDB to GraphQL</h1>
<p>Hey!</p>
<p>Today I'm going to demonstrate how I migrated a MongoDB collection to GraphQL. With Parse shutting
down at the end of the month, there are a lot of applications are looking for a new home for their data
and since GraphQL is the future, it's a great time to migrate! I was genuinely surprised by how easy
the process was so here is a little guide so you can migrate your data yourself.</p>
<h2 id="step-1-define-the-schema">Step 1: Define the schema</h2>
<p>The first step in migrating your data is to prepare your GraphQL schema. I'll be using
<a href="https://raw.githubusercontent.com/mongodb/docs-assets/primer-dataset/primer-dataset.json" target="_blank">MongoDB's sample
restaurants collection found here</a>.
The restaurants collection is defined by a pretty simple Schema. We're going to change a few field names for consistency
and our migration script will handle transforming each data item. Here is our final schema:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>type Restaurant implements Node {
  id: ID!
  name: String!
  mongoId: String!
  cuisine: String!
  borough: String!
  address: Address!
  grades: [Grade]
  createdAt: DateTime
  modifiedAt: DateTime
}

type Address {
  zipcode: String!
  street: String!
  coord: [Float]
  building: String
}

type Grade {
  score: String!
  grade: String
  date: DateTime!
}
</pre></div>
</td></tr></table>

<p>That's it!</p>
<blockquote>
<p>Notice that our <code>Grade</code> and <code>Address</code> types do not implement Node. It is unlikely that <code>Grades</code>
or <code>Addresses</code> are shared by more than one restaurant so there is no need to create full connections
and thus we don't need to implement <code>Node</code>.</p>
</blockquote>
<h2 id="deploy-the-schema-on-scapholdio">Deploy the schema on Scaphold.io</h2>
<p>To get up and running quickly, we'll deploy an API defined by our new schema on Scaphold.io! It takes
about 3 minutes.</p>
<ol>
<li>
<p>Go to <a href="https://scaphold.io/?signupModal=true&source=community">Scaphold.io</a> and create an app.</p>
</li>
<li>
<p>You will be taken to the schema designer where you can create the 3 types listed above. Make sure that your
<code>Address</code> and <code>Grade</code> types do not implement the <code>Node</code> interface.</p>
</li>
<li>
<p>You're done! Don't worry if you made a mistake, the GraphQL type system will let you know
exactly where you went wrong when you start pushing data.</p>
</li>
</ol>
<blockquote>
<p>Tip! Watch this <a href="https://www.youtube.com/watch?v=sgHckUwEWRw" target="_blank">video to learn more about the Scaphold Schema Designer</a></p>
</blockquote>
<h2 id="the-migration-script">The migration script</h2>
<p>In the industry, a migration task like this is referred to as ETL (Extract, Transform, Load) and
is extremely common. We're going to write a simple node.js script that streams data from our
restaurants.json MongoDB dump into our GraphQL API. Our restaurant data might be too large for the
memory on our machine so we are going to read it in line by line and then queue our API calls so
that we do not run out of network bandwidth on our machine.</p>
<p>Here is our script! We are using two packages that are not available to a basic node.js installation.
Before running this script make sure you install <code>async</code> and <code>request-promise</code> via <code>npm install async request-promise</code> from your project
directory.</p>
<p>Take a look at our script.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// migrator.js</span>
<span class="kr">import</span> <span class="nx">fs</span> <span class="nx">from</span> <span class="s1">&#39;fs&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">readline</span> <span class="nx">from</span> <span class="s1">&#39;readline&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">path</span> <span class="nx">from</span> <span class="s1">&#39;path&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">request</span> <span class="nx">from</span> <span class="s1">&#39;request-promise&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">async</span> <span class="nx">from</span> <span class="s1">&#39;async&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">MONGO_COLLECTION_FILE</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;restaurants.json&#39;</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Sets our max concurrency to 250 so we don&#39;t exhaust</span>
<span class="cm"> * local network resources</span>
<span class="cm"> */</span>
<span class="kr">const</span> <span class="nx">asyncQueue</span> <span class="o">=</span> <span class="nx">async</span><span class="p">.</span><span class="nx">queue</span><span class="p">((</span><span class="nx">restaurant</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">createRestaurant</span><span class="p">(</span><span class="nx">restaurant</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">callback</span><span class="p">());</span>
<span class="p">},</span> <span class="mi">250</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Create a read stream. The mongoexport tool outputs a</span>
<span class="cm"> * single JSON object per line.</span>
<span class="cm"> * https://docs.mongodb.com/manual/reference/program/mongoexport/</span>
<span class="cm"> */</span>
<span class="kr">const</span> <span class="nx">readStream</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">MONGO_COLLECTION_FILE</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">lineReader</span> <span class="o">=</span> <span class="nx">readline</span><span class="p">.</span><span class="nx">createInterface</span><span class="p">({</span>
  <span class="nx">input</span><span class="o">:</span> <span class="nx">readStream</span>
<span class="p">});</span>
<span class="nx">lineReader</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="nx">line</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">restaurant</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">line</span><span class="p">);</span>
  <span class="cm">/**</span>
<span class="cm">   * Apply a simple transformation to the restaurant item to adhere</span>
<span class="cm">   * to our graphql schema.</span>
<span class="cm">   *</span>
<span class="cm">   * This takes two steps.</span>
<span class="cm">   *</span>
<span class="cm">   * 1) rename restaurant_id to mongoId</span>
<span class="cm">   * 2) Pull the date out of the nested { $date: ... } structure lying</span>
<span class="cm">   *    under grades.date</span>
<span class="cm">   *</span>
<span class="cm">   * Note: The ... below is the JS rest operator which enumerates</span>
<span class="cm">   * an objects keys and values into another object. You can think</span>
<span class="cm">   * of it as cloning an object. If you don&#39;t use babel then you can</span>
<span class="cm">   * replace the ... (rest operator) with Object.assign()</span>
<span class="cm">   *</span>
<span class="cm">   * It works like this:</span>
<span class="cm">   * var copy = Object.assign({}, { a: 1 }, { b: 2 });</span>
<span class="cm">   * console.log(copy); // { a: 1, b: 2 }</span>
<span class="cm">   */</span>
  <span class="kr">const</span> <span class="nx">modified</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">restaurant</span><span class="p">,</span>
    <span class="nx">mongoId</span><span class="o">:</span> <span class="nx">restaurant</span><span class="p">.</span><span class="nx">restaurant_id</span><span class="p">,</span>
    <span class="nx">grades</span><span class="o">:</span> <span class="nx">restaurant</span><span class="p">.</span><span class="nx">grades</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">grade</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// grade.date currently looks like { $date: &lt;timevalue&gt; }.</span>
      <span class="c1">// We only want the &lt;timevalue&gt;</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">grade</span><span class="p">,</span>
        <span class="nx">date</span><span class="o">:</span> <span class="nx">grade</span><span class="p">.</span><span class="nx">date</span><span class="p">[</span><span class="s1">&#39;$date&#39;</span><span class="p">]</span>
      <span class="p">};</span>
    <span class="p">})</span>
  <span class="p">};</span>
  <span class="c1">// Remove the restaurant id so we don&#39;t upset the GraphQL type system.</span>
  <span class="k">delete</span> <span class="nx">modified</span><span class="p">.</span><span class="nx">restaurant_id</span><span class="p">;</span>
  <span class="nx">asyncQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">modified</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">lineReader</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Make sure you replace the uri with your Scaphold app&#39;s url.</span>
<span class="kr">const</span> <span class="nx">createRestaurant</span> <span class="o">=</span> <span class="nx">restaurant</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">reqOpts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
    <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;https://us-west-2.api.scaphold.io/graphql/&lt;my-alias&gt;&#39;</span><span class="p">,</span>
    <span class="nx">body</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">query</span><span class="o">:</span> <span class="sb">`</span>
<span class="sb">      mutation CreateRestaurant($restaurant: CreateRestaurantInput!) {</span>
<span class="sb">        createRestaurant(input: $restaurant) {</span>
<span class="sb">          changedRestaurant {</span>
<span class="sb">            id</span>
<span class="sb">            name</span>
<span class="sb">          }</span>
<span class="sb">        }</span>
<span class="sb">      }</span>
<span class="sb">      `</span><span class="p">,</span>
      <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">restaurant</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">json</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="nx">request</span><span class="p">(</span><span class="nx">reqOpts</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">      Successfully created restaurant: </span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">createRestaurant</span><span class="p">.</span><span class="nx">changedRestaurant</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb"></span>
<span class="sb">    `</span><span class="p">);</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Error creating restaurant: </span><span class="si">${</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>The $date syntax from the mongodump exists because mongodb stores its documents using BSON not JSON.
BSON is a binary superset of JSON that adds some additional functionality and thus needs the extra
annotations in order serialize itself to JSON.</p>
</blockquote>
<p>If you're following along all you should have to do now is run your migration script via
<code>node ./migrator.js</code>. If everything is setup correctly, your terminal will start printing out
success messages for each item it uploads!</p>
<h2 id="test-the-migration">Test the migration</h2>
<p>As soon as it is done, you can immediately start querying your deployed GraphQL API.
Try this one in the GraphiQL tab in the Scaphold portal and/or from your application:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>query AllRestaurants {
  viewer {
    allRestaurants(first: 50) {
      edges {
        node {
          id
          borough
          name
          mongoId
          cuisine
          address {
            zipcode
            building
            street
            coord
          }
          grades {
            score
            grade
            date
          }
          createdAt
        }
        cursor
      }
    }
  }
}
</pre></div>
</td></tr></table>

<h2 id="migrating-more-complicated-data">Migrating more complicated data</h2>
<p>You can use this same process to easily migrate any data to GraphQL. Scaphold offers a couple
features that can make it a lot easier to migrate more complicated data as well. If you have
native relations in your datasets already, <a href="https://scaphold.io/docs/#nested-create" target="_blank"> take a look at the nested create operators in your
Scaphold API</a>. They allow you create and associate Node implementing types in a single API call.</p>
<p>For example, assume we had the following types.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>type Post implements Node {
  id: ID!
  title: String!
  category: Category
}

type Category implements Node {
  id: ID!
  name: String!
}
</pre></div>
</td></tr></table>

<p>If we had a dataset with a lot of post nodes that were already associated with a category then we
could create our posts as well as associate them with the category with a query like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>mutation CreatePostAndAssociateCategory($post:CreatePostInput!) {
  createPost(input: $post) {
    changedPost {
      id
      title
      category {
        id
        name
      }
    }
  }
}
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// Variables</span>
<span class="p">{</span>
  <span class="s2">&quot;post&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;GraphQL Rocks!&quot;</span><span class="p">,</span>
    <span class="s2">&quot;category&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Next Generation Tech&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>These are just a few techniques we have used to migrate our mongodb data to GraphQL. I hope it helps
and please let me know what you think and if you have any other techniques.</p>
<h3 id="thanks-for-reading">Thanks for reading!</h3>
<p>If you have any questions please let me know below or <a href="http://slack.scaphold.io">Join us on Slack</a>!</p>
<p>We'd love to hear what you think and are even more excited to see what you build!</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../android-push-notifications/" title="Setup Android Push" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Setup Android Push
              </span>
            </div>
          </a>
        
        
          <a href="../persisted-queries/" title="Using Persisted Queries" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Using Persisted Queries
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-7aa26ad9ec.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>