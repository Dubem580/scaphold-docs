
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content=""Securing your APIs is important. Learn how GraphQL can help."">
      
      
      
        <meta name="author" content=""Michael Paris"">
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.2, mkdocs-material-1.3.0">
    
    
      
        <title>Authentication in GraphQL</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-1d1da4857d.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/base.css">
    
      <link rel="stylesheet" href="../../css/styles.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="Scaphold Docs" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Tutorials
                </span>
              
            
            Authentication in GraphQL
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/scaphold-io/scaphold-docs" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Scaphold Docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/scaphold-io/scaphold-docs" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/jumpstart-video/" title="Jumpstart Video" class="md-nav__link">
      Jumpstart Video
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/starter-kits/" title="Starter Kits" class="md-nav__link">
      Starter Kits
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/schema/" title="The Schema" class="md-nav__link">
      The Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/queries/" title="Queries" class="md-nav__link">
      Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/mutations/" title="Mutations" class="md-nav__link">
      Mutations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/subscriptions/" title="Subscriptions" class="md-nav__link">
      Subscriptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../coredata/connections-pagination/" title="Connections" class="md-nav__link">
      Connections
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Authentication
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Authentication
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication/tokens/" title="Auth Tokens" class="md-nav__link">
      Auth Tokens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication/permissions/" title="Permissions" class="md-nav__link">
      Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication/social/" title="Social Auth" class="md-nav__link">
      Social Auth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../authentication/super-users/" title="Super Users" class="md-nav__link">
      Super Users
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Realtime Subscriptions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Realtime Subscriptions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime/subscriptions-apollo/" title="Subscriptions With Apollo Client" class="md-nav__link">
      Subscriptions With Apollo Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime/subscriptions-react/" title="Subscriptions With React" class="md-nav__link">
      Subscriptions With React
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime/slackr-chat-app/" title="Build Slack Tutorial" class="md-nav__link">
      Build Slack Tutorial
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Custom Logic
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Custom Logic
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/composition/" title="Function Composition" class="md-nav__link">
      Function Composition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/pre-operations/" title="Pre Operations" class="md-nav__link">
      Pre Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/operation-phase/" title="Operation Phase" class="md-nav__link">
      Operation Phase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/post-operations/" title="Post Operations" class="md-nav__link">
      Post Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/async-operations/" title="Async Operations" class="md-nav__link">
      Async Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-logic/logs/" title="Logs & Examples" class="md-nav__link">
      Logs & Examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Persisted Queries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Persisted Queries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../persisted-queries/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../persisted-queries/getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../persisted-queries/querying-from-client/" title="Querying From Client" class="md-nav__link">
      Querying From Client
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Files
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Files
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../files/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../files/uploading/" title="Uploading" class="md-nav__link">
      Uploading
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../files/querying/" title="Querying" class="md-nav__link">
      Querying
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Integrations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/email/" title="Email" class="md-nav__link">
      Email
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/passwordless/" title="Passwordless Auth" class="md-nav__link">
      Passwordless Auth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/push/" title="Push Notifications" class="md-nav__link">
      Push Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-6" type="checkbox" id="nav-9-6">
    
    <label class="md-nav__link" for="nav-9-6">
      Search
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-6">
        Search
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/search/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/search/querying/" title="Querying" class="md-nav__link">
      Querying
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-7" type="checkbox" id="nav-9-7">
    
    <label class="md-nav__link" for="nav-9-7">
      Social Auth
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-7">
        Social Auth
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/social/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/social/login-with-native/" title="Login With Native SDKs" class="md-nav__link">
      Login With Native SDKs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/social/login-with-auth0/" title="Login With Auth0" class="md-nav__link">
      Login With Auth0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      App Management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        App Management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/alias/" title="Aliases" class="md-nav__link">
      Aliases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/analytics/" title="Analytics" class="md-nav__link">
      Analytics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/export-schema/" title="Export Schema" class="md-nav__link">
      Export Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/fork-app/" title="Fork App" class="md-nav__link">
      Fork App
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/teams/" title="Teams" class="md-nav__link">
      Teams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/multi-region/" title="Multi Region" class="md-nav__link">
      Multi Region
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/admin-tokens/" title="Admin Tokens" class="md-nav__link">
      Admin Tokens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app-management/token-expiration/" title="Token Expiration" class="md-nav__link">
      Token Expiration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" checked>
    
    <label class="md-nav__link" for="nav-11">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../realtime-apps-with-subscriptions/" title="Build A Chat App" class="md-nav__link">
      Build A Chat App
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sending-push-notifications/" title="Sending Push Notifications" class="md-nav__link">
      Sending Push Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ios-push-notifications/" title="Setup iOS Push" class="md-nav__link">
      Setup iOS Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../android-push-notifications/" title="Setup Android Push" class="md-nav__link">
      Setup Android Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../migrate-mongodb-graphql/" title="Migrating MongoDB" class="md-nav__link">
      Migrating MongoDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../persisted-queries/" title="Using Persisted Queries" class="md-nav__link">
      Using Persisted Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-queries/" title="Advanced Relational Queries" class="md-nav__link">
      Advanced Relational Queries
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Authentication in GraphQL
      </label>
    
    <a href="./" title="Authentication in GraphQL" class="md-nav__link md-nav__link--active">
      Authentication in GraphQL
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#authentication" title="Authentication" class="md-nav__link">
    Authentication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-anatomy-of-a-jwt-json-web-token" title="The Anatomy of a JWT (JSON Web Token)" class="md-nav__link">
    The Anatomy of a JWT (JSON Web Token)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-with-rest" title="Authentication with REST" class="md-nav__link">
    Authentication with REST
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-with-graphql_1" title="Authentication with GraphQL" class="md-nav__link">
    Authentication with GraphQL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authenticate-resolvers-not-endpoints" title="Authenticate resolvers, not endpoints." class="md-nav__link">
    Authenticate resolvers, not endpoints.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resolvers-as-a-composition-of-functions" title="Resolvers as a composition of functions" class="md-nav__link">
    Resolvers as a composition of functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authorization-in-scaphold" title="Authorization in Scaphold" class="md-nav__link">
    Authorization in Scaphold
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#everyone-scope" title="EVERYONE Scope" class="md-nav__link">
    EVERYONE Scope
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authenticated-scope" title="AUTHENTICATED Scope" class="md-nav__link">
    AUTHENTICATED Scope
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-scope" title="ROLE Scope" class="md-nav__link">
    ROLE Scope
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relation-scope" title="RELATION Scope" class="md-nav__link">
    RELATION Scope
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../search-with-algolia/" title="Add Search With Algolia" class="md-nav__link">
      Add Search With Algolia
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aggregations-in-graphql/" title="Aggregations In GraphQL" class="md-nav__link">
      Aggregations In GraphQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../apollo-optics-graphql-server/" title="Integrate Apollo Optics" class="md-nav__link">
      Integrate Apollo Optics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../adding-social-auth/" title="Add Social Auth" class="md-nav__link">
      Add Social Auth
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../errors/" title="Errors" class="md-nav__link">
      Errors
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#authentication" title="Authentication" class="md-nav__link">
    Authentication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-anatomy-of-a-jwt-json-web-token" title="The Anatomy of a JWT (JSON Web Token)" class="md-nav__link">
    The Anatomy of a JWT (JSON Web Token)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-with-rest" title="Authentication with REST" class="md-nav__link">
    Authentication with REST
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-with-graphql_1" title="Authentication with GraphQL" class="md-nav__link">
    Authentication with GraphQL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authenticate-resolvers-not-endpoints" title="Authenticate resolvers, not endpoints." class="md-nav__link">
    Authenticate resolvers, not endpoints.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resolvers-as-a-composition-of-functions" title="Resolvers as a composition of functions" class="md-nav__link">
    Resolvers as a composition of functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authorization-in-scaphold" title="Authorization in Scaphold" class="md-nav__link">
    Authorization in Scaphold
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#everyone-scope" title="EVERYONE Scope" class="md-nav__link">
    EVERYONE Scope
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authenticated-scope" title="AUTHENTICATED Scope" class="md-nav__link">
    AUTHENTICATED Scope
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-scope" title="ROLE Scope" class="md-nav__link">
    ROLE Scope
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relation-scope" title="RELATION Scope" class="md-nav__link">
    RELATION Scope
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/scaphold-io/scaphold-docs/edit/master/docs/tutorials/authentication-in-graphql.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                
                
                <h1 id="authentication-with-graphql">Authentication with GraphQL</h1>
<p>Protecting your APIs is as critical a component as anything else in your application. We believe
that GraphQL is the future of APIs so let's spend a little bit of time discussing how to go about
protecting them. Before we start lets get a few definitions out of the way. This post is about
authentication and authorization. The different between the two is only a
few letters and the fact that they accomplish two different things.</p>
<p><strong>Authentication</strong> has to do with logging users in. This generally involves a cookie if you strictly
building a webpage or a header if you are targetting an API. <a href="https://jwt.io/">JWT's</a> have become
an increasingly popular way to authenticate users with an API.</p>
<p><strong>Authorization</strong> although similar to authentication, involves granting users access to specific
resources in an API. For example, you might be logged in and <em>authenticated</em> as John Deer but John Deer
might not have access to update the profile of Jane Doe and is thus not <em>authorized</em> for that operation.</p>
<p>Application's often have a workflow that looks like this:</p>
<ol>
<li>
<p>A user logs in by providing a username &amp; password and in return gets back an auth token.</p>
</li>
<li>
<p>The client application attaches that auth token to every future request (via the Authorization header).</p>
</li>
<li>
<p>Each time the server receives a request, the server validates the token and fetches the user from
the database.</p>
</li>
<li>
<p>The fetched user object is attached to some context that flows throughout the application.</p>
</li>
<li>
<p>Different parts of your application use the context's user to determine if the user is authorized
for a particular operation.</p>
</li>
<li>
<p>Repeat.</p>
</li>
</ol>
<p><a href="https://scaphold.io">Scaphold</a> provides a number of <strong>authentication</strong> providers such as <a href="https://auth0.com/">Auth0</a>
for social auth, <a href="https://get.digits.com/">Digits</a> for passwordless auth, and traditional username &amp; password
auth.</p>
<p>We also provide powerful <strong>authorization</strong> mechanisms via permissions. Scaphold supports
both role-based and relational access control that can be layered to create powerful authorization
systems.</p>
<p>Let's take a look at each of these concepts in turn to learn how they help us build more robust APIs.</p>
<h2 id="authentication">Authentication</h2>
<p>We just learned that authentication is all about attaching a request or session to a user in the database.
If you are building against a GraphQL API, chances are that you will be using auth tokens. We prefer JWTs
so let's take a look at one.</p>
<h3 id="the-anatomy-of-a-jwt-json-web-token">The Anatomy of a JWT (JSON Web Token)</h3>
<p>This is an example JWT:</p>
<blockquote>
<p>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</p>
</blockquote>
<p>This might look like a random bunch of bits, but there is an order to the chaos. If you head over to <a href="https://jwt.io">jwt.io</a>, you
will find a nifty debugger that can help you make sense of this token.</p>
<p>A JWT is made up of three parts separated by a period <code>.</code></p>
<ol>
<li>
<p>The header contains the algorithm and token type.</p>
</li>
<li>
<p>The payload has an identifier for the user <code>sub</code> as well as other metadata.</p>
</li>
<li>
<p>The signature is a checksum that is calculated by hashing together the header, payload, and a secret key.</p>
</li>
</ol>
<p>When you decode the above token, you should see these values</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// header</span>
<span class="p">{</span>
  <span class="s2">&quot;alg&quot;</span><span class="o">:</span> <span class="s2">&quot;HS256&quot;</span><span class="p">,</span>
  <span class="s2">&quot;typ&quot;</span><span class="o">:</span> <span class="s2">&quot;JWT&quot;</span>
<span class="p">}</span>

<span class="c1">// payload</span>
<span class="p">{</span>
  <span class="s2">&quot;sub&quot;</span><span class="o">:</span> <span class="s2">&quot;1234567890&quot;</span><span class="p">,</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
  <span class="s2">&quot;admin&quot;</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="c1">// signature</span>
<span class="nx">HMACSHA256</span><span class="p">(</span>
  <span class="nx">base64UrlEncode</span><span class="p">(</span><span class="nx">header</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span>
  <span class="nx">base64UrlEncode</span><span class="p">(</span><span class="nx">payload</span><span class="p">),</span>
  <span class="o">&lt;</span><span class="nx">secret_key</span><span class="o">&gt;</span>
<span class="p">)</span>
</pre></div>
</td></tr></table>

<h3 id="authentication-with-rest">Authentication with REST</h3>
<p>So how might our application make use of a JWT? If you notice in the payload, there is a
field called <code>sub</code>. The <code>sub</code> stands for subject and is holds an identifier
for the user that the token represents. To authenticate the user, a server will often have a
piece of code that serves as the gatekeeper and validate these tokens. If you are familiar with
javascript and express, this might look something like this.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">jwt</span> <span class="nx">from</span> <span class="s1">&#39;express-jwt&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">express</span> <span class="nx">from</span> <span class="s1">&#39;express&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/protected&#39;</span><span class="p">,</span>
  <span class="nx">jwt</span><span class="p">({</span><span class="nx">secret</span><span class="o">:</span> <span class="s1">&#39;shhhhhhared-secret&#39;</span><span class="p">}),</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">admin</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">sendStatus</span><span class="p">(</span><span class="mi">401</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendStatus</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
  <span class="p">});</span>
</pre></div>
</td></tr></table>

<p>The <code>express-jwt</code> package understands how to decode a JWT and verify its signature. We are adding
a piece of middleware <code>jwt({secret: 'shhhhhhared-secret'})</code> to the <code>/protected</code> route in our API
so that you can only hit the <code>/protected</code> endpoint if you are authenticated.</p>
<p>You can rinse and repeat this technique all day long if you are building a REST API, but since
we are savvy developers and building GraphQL APIs this model doesn't work quite the same.</p>
<h2 id="authentication-with-graphql_1">Authentication with GraphQL</h2>
<p>GraphQL throws away the old idea that resources in an API should be denoted by some path in the
url. Instead, we get a rich query language that we can use to access all the data on our servers
no matter where it lives. Authenticating a GraphQL API, however, can be a little tricky because
we have to think about things a little differently. Instead of attaching middleware to our endpoints,
we're going to solve this problem by attaching middleware to our GraphQL resolvers. But first, let's
set the scene.</p>
<p>That same server file from above might look like this in GraphQL.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">jwt</span> <span class="nx">from</span><span class="s1">&#39;express-jwt&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">graphqlHTTP</span> <span class="nx">from</span><span class="s1">&#39;express-graphql&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">express</span> <span class="nx">from</span><span class="s1">&#39;express&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">schema</span> <span class="nx">from</span><span class="s1">&#39;./mySchema&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/graphql&#39;</span><span class="p">,</span> <span class="nx">jwt</span><span class="p">({</span>
  <span class="nx">secret</span><span class="o">:</span> <span class="s1">&#39;shhhhhhared-secret&#39;</span><span class="p">,</span>
  <span class="nx">requestProperty</span><span class="o">:</span> <span class="s1">&#39;auth&#39;</span><span class="p">,</span>
  <span class="nx">credentialsRequired</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">}));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/graphql&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">sub</span><span class="p">);</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span> <span class="nx">user</span><span class="p">,</span>
  <span class="p">}</span>
  <span class="nx">done</span><span class="p">();</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/graphql&#39;</span><span class="p">,</span> <span class="nx">graphqlHTTP</span><span class="p">(</span><span class="nx">req</span> <span class="p">=&gt;</span> <span class="p">({</span>
    <span class="nx">schema</span><span class="o">:</span> <span class="nx">schema</span><span class="p">,</span>
    <span class="nx">context</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span>
  <span class="p">})</span>
<span class="p">));</span>
</pre></div>
</td></tr></table>

<p>This is where things get interesting. This API is not secure at all. It might try to verify the JWT
but if the JWT doesn't exist or is invalid, the request will still pass through (see <code>credentialsRequired: false</code>).
Why? We have to allow the request to pass through because if we blocked it we would block the entire API.
That means, our users wouldn't even be able to call a <code>loginUser</code> mutation to get a token to authenticate themselves.
This is no good.</p>
<p>The good news that GraphQL gives us a whole set of tools to build even more robust authentication
mechanisms than we could with REST. First, we'll cover the basics and then I'll introduce a
technique that will make authentication much more scalable and fun to use.</p>
<h2 id="authenticate-resolvers-not-endpoints">Authenticate resolvers, not endpoints.</h2>
<p>When you build a GraphQL API, you define a set of types each of which contains a set of fields and an
optional resolver function that knows how to fetch the data necessary to satisfy that field. Here is a barebones
example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">GraphQLSchema</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;graphql&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Registry</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;graphql-helpers&#39;</span><span class="p">;</span>

<span class="c1">// The registry wraps graphql-js and is more concise</span>
<span class="kr">const</span> <span class="nx">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Registry</span><span class="p">();</span>

<span class="nx">registry</span><span class="p">.</span><span class="nx">createType</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">  type User {</span>
<span class="sb">    id: ID!</span>
<span class="sb">    username: String!</span>
<span class="sb">  }</span>
<span class="sb">`</span><span class="p">;</span>

<span class="nx">registry</span><span class="p">.</span><span class="nx">createType</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">  type Query {</span>
<span class="sb">    me: User</span>
<span class="sb">  }</span>
<span class="sb">`</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">me</span><span class="o">:</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;User is not logged in (or authenticated).&#39;</span><span class="p">);</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GraphQLSchema</span><span class="p">({</span>
  <span class="nx">query</span><span class="o">:</span> <span class="nx">registry</span><span class="p">.</span><span class="nx">getType</span><span class="p">(</span><span class="s1">&#39;Query&#39;</span><span class="p">),</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p>By the time the request gets to our <code>Query.me</code> resolver, the server middleware has already tried
to authenticate the user and fetch the user object from the database. In our resolver, we can then
check the graphql context for the user (we set the context in our <code>server.js</code> file) and if one
exists then return it else throw an error.</p>
<blockquote>
<p>Note: you could just as easily return null instead of throwing an error and I would actually recommend it.</p>
</blockquote>
<p>You can use this technique to start authenticating your GraphQL APIs in a moments notice. You might
realize, however, that this could get pretty dirty if we had to check for a user in each of our
resolvers. This will be especially transparent as you start to build more powerful authentication
systems. Before we leave, let's go over a more scalable way to accomplish this.</p>
<h2 id="resolvers-as-a-composition-of-functions">Resolvers as a composition of functions</h2>
<p>If you are familiar with <code>express</code> (or many other web frameworks for that matter), you have likely
heard of or used middleware functions. In fact, when we called <code>app.get('/protected', ...)</code> earlier,
we were applying a piece of middleware to the <code>/protected</code> route handler. Being able to apply
middleware like this is a very powerful technique that is an example of a more general programming
concept called <a href="https://en.wikipedia.org/wiki/Function_composition_(computer_science)">function composition</a>.
That's a fancy term for combining multiple small functions to create a single more powerful one.</p>
<p>Just like how <code>express</code> uses middleware to process requests coming in and responses going out, we
can use function composition to make more maintainable and <a href="https://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a>
GraphQL resolvers. This is the same
technique that powers our <strong>Logic Functions</strong> at <a href="https://scaphold.io">scaphold</a> that allows you
to pull microservices from all around the web into your Scaphold GraphQL API.</p>
<p>It might take a few minutes to wrap your head around how exactly function composition works but
I promise that it will make you a better programmer if you master the technique. Let's rewrite the
code above using our new and improved functional technique.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">GraphQLSchema</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;graphql&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Registry</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;graphql-helpers&#39;</span><span class="p">;</span>
<span class="c1">// See an implementation of compose https://gist.github.com/mlp5ab/f5cdee0fe7d5ed4e6a2be348b81eac12</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">compose</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./compose&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Registry</span><span class="p">();</span>

<span class="cm">/**</span>
<span class="cm">* The authenticated function checks for a user and calls the next function in the composition if</span>
<span class="cm">* one exists. If no user exists in the context then an error is thrown.</span>
<span class="cm">*/</span>
<span class="kr">const</span> <span class="nx">authenticated</span> <span class="o">=</span>
  <span class="p">(</span><span class="nx">fn</span><span class="o">:</span> <span class="nx">GraphQLFieldResolver</span><span class="p">)</span> <span class="p">=&gt;</span>
  <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">info</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;User is not authenticated&#39;</span><span class="p">);</span>
  <span class="p">};</span>

<span class="cm">/*</span>
<span class="cm">* getLoggedInUser returns the logged in user from the context.</span>
<span class="cm">*/</span>
<span class="kr">const</span> <span class="nx">getLoggedInUser</span> <span class="o">=</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">context</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>

<span class="nx">registry</span><span class="p">.</span><span class="nx">createType</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">  type User {</span>
<span class="sb">    id: ID!</span>
<span class="sb">    username: String!</span>
<span class="sb">  }</span>
<span class="sb">`</span><span class="p">;</span>

<span class="nx">registry</span><span class="p">.</span><span class="nx">createType</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">  type Query {</span>
<span class="sb">    me: User</span>
<span class="sb">  }</span>
<span class="sb">`</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">me</span><span class="o">:</span> <span class="nx">compose</span><span class="p">(</span><span class="nx">authenticated</span><span class="p">)(</span><span class="nx">getLoggedInUser</span><span class="p">)</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GraphQLSchema</span><span class="p">({</span>
  <span class="nx">query</span><span class="o">:</span> <span class="nx">registry</span><span class="p">.</span><span class="nx">getType</span><span class="p">(</span><span class="s1">&#39;Query&#39;</span><span class="p">),</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p>The above code will work exactly the same as the first snippet. Instead of checking for the user
in our main resolver function, we have created a highly reusable and testable middleware function
that achieves the same thing. The immediate impact of this design may not be apparent yet but think
about what would happen if we wanted to add another protected route as well as log our
resolver running times. With our new design its as simple as:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">traceResolve</span> <span class="o">=</span>
  <span class="p">(</span><span class="nx">fn</span><span class="o">:</span> <span class="nx">GraphQLFieldResolver</span><span class="p">)</span> <span class="p">=&gt;</span>
  <span class="nx">async</span> <span class="p">(</span><span class="nx">obj</span><span class="o">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">args</span><span class="o">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">context</span><span class="o">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">info</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
    <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">info</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">end</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Resolver took </span><span class="si">${</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="si">}</span><span class="sb"> ms`</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">};</span>

<span class="nx">registry</span><span class="p">.</span><span class="nx">createType</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">  type Query {</span>
<span class="sb">    me: User</span>
<span class="sb">    otherSecretData: SecretData</span>
<span class="sb">  }</span>
<span class="sb">`</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">me</span><span class="o">:</span> <span class="nx">compose</span><span class="p">(</span><span class="nx">traceResolve</span><span class="p">,</span> <span class="nx">authenticated</span><span class="p">)(</span><span class="nx">getLoggedInUser</span><span class="p">)</span>
  <span class="nx">otherSecretData</span><span class="o">:</span> <span class="nx">compose</span><span class="p">(</span><span class="nx">traceResolve</span><span class="p">,</span> <span class="nx">authenticated</span><span class="p">)(</span><span class="nx">getSecretData</span><span class="p">)</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>

<p>Using this technique will help you build more robust GraphQL APIs. Function composition is a great
solution for authentication tasks but you can also use it for logging resolvers, cleaning input,
massaging output, and much more.</p>
<h2 id="authorization-in-scaphold">Authorization in Scaphold</h2>
<p>These techniques are powerful building blocks for those of you who want to build your own GraphQL
servers. If you want to get started right now, then we at Scaphold have already built all of This
for you so you can start building awesome apps. At Scaphold, our permissions allow you define
custom access control rules over your data. There are 4 permission scopes each of enforces slightly
different behavior.</p>
<h3 id="everyone-scope">EVERYONE Scope</h3>
<p>The everyone scope does what you might have guessed. It authorizes everyone everyone whether you
are authenticated or not. This is useful if you want any user to be able to read a public forum
for example.</p>
<h3 id="authenticated-scope">AUTHENTICATED Scope</h3>
<p>The authenticated scope is just as simple. It's a boolean check that authorizes an operation if the
user is authenticated and reject the operation if the user is not. This can be useful if you would
only like logged in users to create posts for example.</p>
<h3 id="role-scope">ROLE Scope</h3>
<p>The role scope is slightly more complex. Role scoped permissions allow for Role based access control
rules. That means you can define roles, enroll users into roles, and then apply a permission that
grants members of that role access to certain operations. Getting started with roles is simple:</p>
<p>First create a roll and enroll a user into the role.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span># First create a role
mutation CreateRole($newrole:CreateRoleInput!) {
  createRole(input:$newrole) {
    changedRole {
      id
      name
    }
  }
}

# Then enroll a user into that role
mutation EnrollUser($enrollment:AddToUserRolesConnectionInput!) {
  addToUserRolesConnection(input:$enrollment) {
    changedUserRoles {
      user {
        id
      }
      role {
        id
      }
    }
  }
}
</pre></div>
</td></tr></table>

<p>Then add a ROLE scope permission to certain operations for a type using the <strong>Add Permission</strong> button
in the schema designer.</p>
<h3 id="relation-scope">RELATION Scope</h3>
<p>The relation scope is the most advanced permission scope. Role based permissions allow you to
manually manage role membership and grant access users access to entire types all at once. The relation
scope uses the natural connections in your API to grant users access to objects that they are
connected to through some user field path. Let's look at an example from an app like slack.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span># Our simple slack schema
type User {
  id: ID!
  channels: ChannelConnection
  messages: MessageConnection
}

type Channel {
  id: ID!
  name: String!
  members: UserConnection
  messages: MessageConnection
}

type Message {
  id: ID!
  content: String!
  channel: Channel
  author: User
}
</pre></div>
</td></tr></table>

<p>Let's say we were building slack and we wanted our users to only be able to read and create messages
in channels that they are a member of. To do this we would create the following RELATION scoped permission</p>
<p><img alt="Relation scope permission" src="http://assets.scaphold.io/community/blog/authentication-in-graphql/messagepermission.png" title="Relation scope permission" /></p>
<p>Once that permission is in place you can query for objects connected to your user
through <code>viewer.user</code>. We leverage the graphql type system to keep performance quick
as we don't need to issue any other queries to know that you are attached to the results
when you query through <code>viewer.user</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>query MyChannelsAndMessages {
  viewer {
    user {
      channels {
        edges {
          node {
            name
            messages {
              edges {
                node {
                  id
                  content
                }
              }
            }
          }
        }
      }
    }
  }
}
</pre></div>
</td></tr></table>

<p>Relation scoped permissions also protect mutations. We checked <strong>create</strong> when we added our permission
so now this mutation will only succeed the logged in user is already a member channel with id
<code>channelId</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>mutation CreateMessage($input:CreateMessageInput!) {
  createMessage(input:$input) {
    changedMessage {
      id
      content
      channel {
        name
      }
    }
  }
}

# Variables
{
  &quot;input&quot;: {
    &quot;content&quot;: &quot;I rest easy when my data is protected.&quot;,
    &quot;channelId&quot;: &quot;ABC&quot; # This value determines if the operation will succeed
  }
}
</pre></div>
</td></tr></table>

<p>RELATION scoped permissions can have arbitrarily long user field paths. This means you can layer
permissions on any operation that is connected to user via some path in your APIs graph. Stay tuned
because we have even more powerful permissions features on the way that will give you even more
freedom in deciding how you would like to lock down your data.</p>
<h1 id="build-better-apps-with-graphql">Build better apps with GraphQL</h1>
<p>I hope this post helped give a better understanding for how you can implement authentication with
GraphQL. If you are itching to get started building with GraphQL, check out <a href="https://scaphold.io">Scaphold's GraphQL Backend as a Service</a>
platform. We have already built all of this plus much more so that you can get a scalable, secure GraphQL API that you can
extend with your own business logic to rapidly build applications. Plus it's free for development!</p>
<p>Thanks for reading! Please let me know what you think in the comments!</p>
<p>Happy Scapholding!</p>
<p><a href="http://slack.scaphold.io">Join Scaphold on slack</a></p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../advanced-queries/" title="Advanced Relational Queries" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Advanced Relational Queries
              </span>
            </div>
          </a>
        
        
          <a href="../search-with-algolia/" title="Add Search With Algolia" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Add Search With Algolia
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-7aa26ad9ec.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>